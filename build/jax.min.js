(function(){"use strict";var Promise,Request,isArray,jax,merge,parameterize,parse,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty;Request=function(){function Request(options){var defaults,key,value,_ref;if(this.options=options,defaults={type:"GET",data:null,url:!1},this.successful=new Promise,this.failure=new Promise,this.request=new XMLHttpRequest,this.options=merge(defaults,this.options),this.request.onreadystatechange=function(_this){return function(){var successCodes,_ref;return successCodes=[200,304],4===_this.request.readyState?(_ref=_this.request.status,__indexOf.call(successCodes,_ref)>=0?_this.successful.setData(parse(_this.request.responseText),_this.request):_this.failure.setData(_this.request.responseText,_this.request)):void 0}}(this),this.request.open(this.options.type,this.options.url,!0),null!=this.options.headers){_ref=this.options.headers;for(key in _ref)value=_ref[key],this.request.setRequestHeader(key,value)}this.request.send(parameterize(this.options.data))}return Request.prototype.then=function(successCallback,failCallback){return this.successful.setHandler(successCallback),null!=failCallback&&this.failure.setHandler(failCallback),this},Request.prototype.success=function(callback){return this.successful.setHandler(callback),this},Request.prototype.fail=function(callback){return this.failure.setHandler(callback),this},Request}(),Promise=function(){function Promise(){this.done=!1,this.handler=null,this.data=null,this.obj=null}return Promise.prototype.setHandler=function(callback){return this.done?callback(this.data,this.obj):this.handler=callback,this},Promise.prototype.setData=function(data,obj){return null!==this.handler?this.handler(data,obj):(this.data=data,this.obj=obj,this.done=!0),this},Promise}(),parse=function(input){var error,response,safetyString;safetyString="while(1);",input.substring(0,safetyString.length)===safetyString&&(input=input.slice(safetyString.length));try{response=JSON.parse(input)}catch(_error){error=_error,response=input}return response},parameterize=function(input){var add,index,key,result,spaceChars,value,_i,_len;if("string"==typeof input)return input;if("function"==typeof input&&(input=input()),result=[],spaceChars=/%20/g,add=function(key,value){return"function"==typeof value&&(value=value()),null===value&&(value=""),key=encodeURIComponent(key),value=encodeURIComponent(value),result[result.length]=""+key+"="+value},isArray(input))for(index=_i=0,_len=input.length;_len>_i;index=++_i)value=input[index],add(index,value);else if("object"==typeof input)for(key in input)__hasProp.call(input,key)&&(value=input[key],add(key,value));return result.join("&").replace(spaceChars,"+")},merge=function(object,properties){var key,value;for(key in properties)value=properties[key],object[key]=value;return object},isArray=function(item){return"[object Array]"===Object.prototype.toString.call(item)},jax=function(options){return new Request(options)},jax.get=function(url){var options;return options={type:"GET",url:url},new Request(options)},jax.post=function(url,data){var options;return options={type:"POST",url:url,data:data},new Request(options)},"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports=jax:"undefined"!=typeof define&&null!==define&&null!=define.amd?define(function(){return jax}):window.jax=jax}).call(this);